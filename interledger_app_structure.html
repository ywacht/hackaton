<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PayLink - Pagos Interledger Profesional</title>
    <link rel="stylesheet" href="styles.css">
    <meta name="theme-color" content="#667eea">
    <!-- PWA Meta Tags para funcionar como app móvil -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="PayLink">
    <link rel="manifest" href="manifest.json">
</head>
<body>
    <!-- PANTALLA DE CARGA INICIAL -->
    <div id="loadingScreen" class="loading-screen">
        <div class="loading-content">
            <div class="loading-logo">💳</div>
            <div class="loading-text">Conectando a Interledger...</div>
            <div class="loading-spinner"></div>
        </div>
    </div>

    <!-- PANTALLA DE LOGIN -->
    <div id="loginScreen" class="screen login-screen">
        <div class="login-container">
            <div class="login-header">
                <div class="logo">💳 PayLink</div>
                <h2>Acceso Seguro</h2>
                <p>Conecta tu billetera Interledger</p>
            </div>
            
            <!-- Opciones de inicio de sesión -->
            <div class="login-options">
                <!-- Opción 1: Billetera Interledger -->
                <div class="login-option" onclick="loginWithWallet()">
                    <div class="option-icon">🔗</div>
                    <div class="option-content">
                        <h3>Billetera Interledger</h3>
                        <p>Conectar con tu billetera existente</p>
                    </div>
                    <div class="option-arrow">→</div>
                </div>

                <!-- Opción 2: Crear nueva billetera -->
                <div class="login-option" onclick="createWallet()">
                    <div class="option-icon">✨</div>
                    <div class="option-content">
                        <h3>Crear Nueva Billetera</h3>
                        <p>Configurar nueva cuenta ILP</p>
                    </div>
                    <div class="option-arrow">→</div>
                </div>

                <!-- Opción 3: Demo/Prueba -->
                <div class="login-option" onclick="demoLogin()">
                    <div class="option-icon">🧪</div>
                    <div class="option-content">
                        <h3>Modo Demostración</h3>
                        <p>Probar con billetera de prueba</p>
                    </div>
                    <div class="option-arrow">→</div>
                </div>
            </div>

            <!-- Formulario de conexión manual -->
            <div id="manualConnectForm" class="manual-connect" style="display: none;">
                <h3>Conectar Manualmente</h3>
                <div class="form-group">
                    <label>URL del Wallet</label>
                    <input type="text" id="walletUrl" class="form-control" placeholder="https://tu-wallet.com">
                </div>
                <div class="form-group">
                    <label>Token de Acceso</label>
                    <input type="password" id="accessToken" class="form-control" placeholder="Tu token de acceso">
                </div>
                <button onclick="connectManually()" class="btn btn-primary">Conectar</button>
                <button onclick="cancelManualConnect()" class="btn btn-secondary">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- PANTALLA PRINCIPAL DE LA APP -->
    <div id="mainApp" class="screen main-app" style="display: none;">
        <!-- Header con navegación -->
        <header class="app-header">
            <div class="header-content">
                <div class="user-info">
                    <div class="user-avatar">👤</div>
                    <div class="user-details">
                        <div class="user-name" id="userName">Usuario</div>
                        <div class="connection-status" id="connectionStatus">
                            <span class="status-indicator status-connected"></span>
                            Conectado
                        </div>
                    </div>
                </div>
                <div class="header-actions">
                    <button class="icon-btn" onclick="showNotifications()">🔔</button>
                    <button class="icon-btn" onclick="showSettings()">⚙️</button>
                    <button class="icon-btn" onclick="logout()">🚪</button>
                </div>
            </div>
        </header>

        <!-- Navegación principal -->
        <nav class="main-nav">
            <button class="nav-btn active" onclick="showSection('wallet')">
                <span class="nav-icon">💰</span>
                <span class="nav-text">Billetera</span>
            </button>
            <button class="nav-btn" onclick="showSection('payments')">
                <span class="nav-icon">💸</span>
                <span class="nav-text">Pagos</span>
            </button>
            <button class="nav-btn" onclick="showSection('events')">
                <span class="nav-icon">🎪</span>
                <span class="nav-text">Eventos</span>
            </button>
            <button class="nav-btn" onclick="showSection('history')">
                <span class="nav-icon">📊</span>
                <span class="nav-text">Historial</span>
            </button>
        </nav>

        <!-- Contenido principal -->
        <main class="main-content">
            <!-- SECCIÓN: BILLETERA -->
            <section id="walletSection" class="content-section active">
                <div class="wallet-overview">
                    <div class="balance-card">
                        <div class="balance-header">
                            <h3>Saldo Total</h3>
                            <button class="refresh-btn" onclick="refreshBalance()">🔄</button>
                        </div>
                        <div class="balance-amount" id="mainBalance">$0.00</div>
                        <div class="balance-subtitle">USD equivalente</div>
                        <div class="balance-actions">
                            <button class="btn btn-primary" onclick="showReceiveModal()">📥 Recibir</button>
                            <button class="btn btn-secondary" onclick="showSendModal()">📤 Enviar</button>
                        </div>
                    </div>
                    
                    <div class="wallet-details">
                        <div class="detail-item">
                            <label>Dirección ILP</label>
                            <div class="address-container">
                                <input type="text" id="userIlpAddress" class="form-control" readonly>
                                <button class="copy-btn" onclick="copyAddress()">📋</button>
                            </div>
                        </div>
                        <div class="detail-item">
                            <label>Estado de la Red</label>
                            <div id="networkStatus" class="network-info">
                                <span class="status-indicator status-connected"></span>
                                <span>Interledger Network - Activo</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- SECCIÓN: PAGOS -->
            <section id="paymentsSection" class="content-section">
                <div class="payments-container">
                    <div class="quick-actions">
                        <h3>Acciones Rápidas</h3>
                        <div class="quick-action-grid">
                            <button class="quick-action" onclick="scanQR()">
                                <div class="action-icon">📱</div>
                                <div class="action-text">Escanear QR</div>
                            </button>
                            <button class="quick-action" onclick="payByPhone()">
                                <div class="action-icon">📞</div>
                                <div class="action-text">Pagar por Teléfono</div>
                            </button>
                            <button class="quick-action" onclick="payByCard()">
                                <div class="action-icon">💳</div>
                                <div class="action-text">Pagar con Tarjeta</div>
                            </button>
                            <button class="quick-action" onclick="requestPayment()">
                                <div class="action-icon">💰</div>
                                <div class="action-text">Solicitar Pago</div>
                            </button>
                        </div>
                    </div>

                    <!-- Formulario de pago detallado -->
                    <div class="payment-form-container">
                        <h3>Enviar Pago</h3>
                        <form id="paymentForm" onsubmit="processPayment(event)">
                            <div class="form-group">
                                <label>Destinatario</label>
                                <input type="text" id="recipientAddress" class="form-control" 
                                       placeholder="$destinatario.wallet.ejemplo/~usuario" required>
                                <button type="button" class="input-helper" onclick="showContactList()">👥</button>
                            </div>
                            
                            <div class="form-group">
                                <label>Cantidad</label>
                                <div class="amount-input">
                                    <span class="currency-symbol">$</span>
                                    <input type="number" id="paymentAmount" class="form-control" 
                                           placeholder="0.00" step="0.01" required>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>Concepto</label>
                                <input type="text" id="paymentConcept" class="form-control" 
                                       placeholder="¿Para qué es este pago?">
                            </div>
                            
                            <div class="form-group">
                                <label>Prioridad</label>
                                <select id="paymentPriority" class="form-control">
                                    <option value="normal">Normal</option>
                                    <option value="high">Alta (+ fee)</option>
                                    <option value="instant">Instantáneo (+ fee)</option>
                                </select>
                            </div>
                            
                            <button type="submit" class="btn btn-primary btn-large">
                                💸 Enviar Pago
                            </button>
                        </form>
                    </div>
                </div>
            </section>

            <!-- SECCIÓN: EVENTOS -->
            <section id="eventsSection" class="content-section">
                <div class="events-container">
                    <div class="events-header">
                        <h3>Eventos Virtuales</h3>
                        <div class="events-filters">
                            <button class="filter-btn active" onclick="filterEvents('all')">Todos</button>
                            <button class="filter-btn" onclick="filterEvents('music')">Música</button>
                            <button class="filter-btn" onclick="filterEvents('tech')">Tecnología</button>
                            <button class="filter-btn" onclick="filterEvents('art')">Arte</button>
                        </div>
                    </div>
                    
                    <div id="eventsGrid" class="events-grid">
                        <!-- Los eventos se cargarán dinámicamente desde JavaScript -->
                    </div>
                </div>
            </section>

            <!-- SECCIÓN: HISTORIAL -->
            <section id="historySection" class="content-section">
                <div class="history-container">
                    <div class="history-header">
                        <h3>Historial de Transacciones</h3>
                        <div class="history-filters">
                            <button class="filter-btn active" onclick="filterHistory('all')">Todas</button>
                            <button class="filter-btn" onclick="filterHistory('sent')">Enviadas</button>
                            <button class="filter-btn" onclick="filterHistory('received')">Recibidas</button>
                        </div>
                    </div>
                    
                    <div id="transactionsList" class="transactions-list">
                        <!-- Las transacciones se cargarán dinámicamente -->
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- MODALES -->
    
    <!-- Modal de Confirmación de Pago -->
    <div id="paymentConfirmModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Confirmar Pago</h3>
                <button class="close-btn" onclick="closeModal('paymentConfirmModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="payment-summary">
                    <div class="summary-item">
                        <span>Destinatario:</span>
                        <span id="confirmRecipient"></span>
                    </div>
                    <div class="summary-item">
                        <span>Cantidad:</span>
                        <span id="confirmAmount" class="amount-highlight"></span>
                    </div>
                    <div class="summary-item">
                        <span>Concepto:</span>
                        <span id="confirmConcept"></span>
                    </div>
                    <div class="summary-item">
                        <span>Fee estimado:</span>
                        <span id="confirmFee">$0.01</span>
                    </div>
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeModal('paymentConfirmModal')">Cancelar</button>
                <button class="btn btn-primary" onclick="confirmPayment()">Confirmar Pago</button>
            </div>
        </div>
    </div>

    <!-- Modal de Éxito -->
    <div id="successModal" class="modal">
        <div class="modal-content success-modal">
            <div class="success-content">
                <div class="success-icon">✅</div>
                <h3>¡Operación Exitosa!</h3>
                <p id="successMessage"></p>
                <div id="eventAccessInfo" style="display: none;">
                    <div class="access-info">
                        <h4>🎫 Acceso al Evento</h4>
                        <p>Se ha enviado el enlace de acceso a tu email.</p>
                        <div class="access-link">
                            <input type="text" id="eventLink" readonly class="form-control">
                            <button onclick="copyEventLink()" class="btn btn-secondary">Copiar Link</button>
                        </div>
                    </div>
                </div>
                <button class="btn btn-primary" onclick="closeModal('successModal')">Continuar</button>
            </div>
        </div>
    </div>

    <!-- Modal de Escanear QR -->
    <div id="qrModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Escanear Código QR</h3>
                <button class="close-btn" onclick="closeModal('qrModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div id="qrReader" class="qr-reader">
                    <!-- Aquí irá el lector de QR -->
                    <div class="camera-placeholder">
                        <p>📱 Cámara se activará aquí</p>
                        <p>Apunta al código QR para pagar</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="config.js"></script>
    <script src="interledger-api.js"></script>
    <script src="payment-handler.js"></script>
    <script src="ui-controller.js"></script>
    <script src="main.js"></script>

    <!-- INSTRUCCIONES DETALLADAS PARA DESARROLLADORES -->
    <script>
        /*
        ========================================================================
        📋 INSTRUCCIONES PARA IMPLEMENTACIÓN EN JAVASCRIPT
        ========================================================================
        
        🔥 ARCHIVOS QUE NECESITAS CREAR Y CONFIGURAR:
        
        1️⃣ config.js - Configuración global
        ----------------------------------------
        const CONFIG = {
            // URLs de billeteras de prueba Interledger
            TEST_WALLETS: {
                demo: {
                    url: 'https://red.ilpv4.dev',
                    address: '$red.ilpv4.dev/alice',
                    token: 'tu_token_de_prueba'
                },
                rafiki: {
                    url: 'https://rafiki.money',
                    address: '$rafiki.money/alice',
                    token: 'tu_token_rafiki'
                }
            },
            
            // APIs de eventos (puedes usar Firebase, Supabase, etc.)
            EVENTS_API: 'https://tu-api-eventos.com/api',
            
            // Configuración de pagos
            DEFAULT_CURRENCY: 'USD',
            MIN_AMOUNT: 0.01,
            MAX_AMOUNT: 10000
        };

        2️⃣ interledger-api.js - Conexión con Interledger
        ------------------------------------------------
        class InterledgerAPI {
            constructor() {
                this.wallet = null;
                this.isConnected = false;
            }
            
            // IMPLEMENTAR: Conectar con billetera real
            async connectWallet(walletConfig) {
                try {
                    // Usar STREAM payments de Interledger
                    // Conectar con Web Monetization API si está disponible
                    // Ejemplo básico:
                    
                    if (document.monetization) {
                        // Web Monetization está disponible
                        this.setupWebMonetization(walletConfig.address);
                    }
                    
                    // O usar bibliotecas como ilp-protocol-stream
                    const { createConnection } = require('@interledger/stream-receiver');
                    this.connection = await createConnection({
                        plugin: walletConfig.plugin,
                        destinationAccount: walletConfig.address
                    });
                    
                    this.isConnected = true;
                    return true;
                } catch (error) {
                    console.error('Error conectando billetera:', error);
                    return false;
                }
            }
            
            // IMPLEMENTAR: Obtener saldo real
            async getBalance() {
                if (!this.isConnected) return 0;
                
                // Hacer petición HTTP a tu wallet provider
                // Ejemplo con fetch:
                const response = await fetch(`${this.wallet.url}/balance`, {
                    headers: {
                        'Authorization': `Bearer ${this.wallet.token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                return data.balance;
            }
            
            // IMPLEMENTAR: Enviar pago real
            async sendPayment(recipient, amount, memo) {
                if (!this.isConnected) throw new Error('No conectado');
                
                // Usar STREAM para enviar pago
                const payment = await this.connection.createStream();
                const result = await payment.sendMoney({
                    destinationAccount: recipient,
                    sourceAmount: (amount * 1000000).toString(), // convertir a unidades más pequeñas
                    memo: memo
                });
                
                return {
                    success: true,
                    transactionId: result.id,
                    fee: result.fee
                };
            }
        }

        3️⃣ payment-handler.js - Lógica de pagos
        ----------------------------------------
        class PaymentHandler {
            constructor(ilpApi) {
                this.ilp = ilpApi;
            }
            
            // IMPLEMENTAR: Procesar pago de evento
            async processEventPayment(eventId, amount) {
                try {
                    // 1. Verificar disponibilidad del evento
                    const event = await this.getEventDetails(eventId);
                    if (!event.available) throw new Error('Evento no disponible');
                    
                    // 2. Procesar pago via Interledger
                    const payment = await this.ilp.sendPayment(
                        event.paymentAddress, 
                        amount, 
                        `Entrada para ${event.name}`
                    );
                    
                    // 3. Generar enlace de acceso
                    const accessLink = await this.generateEventAccess(eventId, payment.transactionId);
                    
                    // 4. Enviar email con enlace (opcional)
                    await this.sendAccessEmail(accessLink);
                    
                    return {
                        success: true,
                        accessLink: accessLink,
                        transactionId: payment.transactionId
                    };
                } catch (error) {
                    throw error;
                }
            }
            
            // IMPLEMENTAR: Generar enlace de acceso al evento
            async generateEventAccess(eventId, transactionId) {
                // Llamar a tu API de eventos
                const response = await fetch(`${CONFIG.EVENTS_API}/generate-access`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        eventId: eventId,
                        paymentProof: transactionId,
                        timestamp: Date.now()
                    })
                });
                
                const data = await response.json();
                return data.accessUrl;
                
                // Ejemplo de URL generada:
                // https://eventos.com/join/abc123?token=xyz789&expires=1234567890
            }
            
            // IMPLEMENTAR: Pago por teléfono (NFC/Bluetooth)
            async payByPhone() {
                if ('NDEFReader' in window) {
                    // Usar Web NFC API
                    const ndef = new NDEFReader();
                    await ndef.scan();
                    
                    ndef.addEventListener("reading", ({ message, serialNumber }) => {
                        // Procesar datos NFC y extraer información de pago
                        const paymentData = this.parseNFCData(message);
                        this.initPayment(paymentData);
                    });
                } else if ('bluetooth' in navigator) {
                    // Usar Web Bluetooth API como alternativa
                    const device = await navigator.bluetooth.requestDevice({
                        filters: [{ name: 'PayLink-*' }]
                    });
                    
                    const server = await device.gatt.connect();
                    // Implementar comunicación Bluetooth para pagos
                }
            }
            
            // IMPLEMENTAR: Integración con tarjetas
            async payByCard() {
                if ('PaymentRequest' in window) {
                    const supportedMethods = [{
                        supportedMethods: 'interledger',
                        data: {
                            merchantId: 'tu-merchant-id',
                            environment: 'production' // o 'sandbox'
                        }
                    }];
                    
                    const details = {
                        total: {
                            label: 'Total',
                            amount: { currency: 'USD', value: amount }
                        }
                    };
                    
                    const request = new PaymentRequest(supportedMethods, details);
                    const response = await request.show();
                    
                    // Procesar respuesta del pago
                    await response.complete('success');
                }
            }
        }

        4️⃣ ui-controller.js - Control de interfaz
        ------------------------------------------
        class UIController {
            constructor() {
                this.currentSection = 'wallet';
                this.isLoggedIn = false;
            }
            
            // IMPLEMENTAR: Mostrar pantalla de login
            showLoginScreen() {
                document.getElementById('loadingScreen').style.display = 'none';
                document.getElementById('loginScreen').style.display = 'flex';
            }
            
            // IMPLEMENTAR: Mostrar app principal después del login
            showMainApp(userData) {
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                
                // Actualizar datos del usuario
                document.getElementById('userName').textContent = userData.name;
                document.getElementById('userIlpAddress').value = userData.ilpAddress;
                document.getElementById('mainBalance').textContent = `$${userData.balance.toFixed(2)}`;
                
                this.isLoggedIn = true;
            }
            
            // IMPLEMENTAR: Cargar eventos dinámicamente
            async loadEvents() {
                try {
                    const response = await fetch(`${CONFIG.EVENTS_API}/events`);
                    const events = await response.json();
                    
                    const eventsGrid = document.getElementById('eventsGrid');
                    eventsGrid.innerHTML = '';
                    
                    events.forEach(event => {
                        const eventCard = this.createEventCard(event);
                        eventsGrid.appendChild(eventCard);
                    });
                } catch (error) {
                    console.error('Error cargando eventos:', error);
                }
            }
            
            // IMPLEMENTAR: Crear tarjeta de evento
            createEventCard(event) {
                const card = document.createElement('div');
                card.className = 'event-card';
                card.innerHTML = `
                    <div class="event-image">${event.icon}</div>
                    <div class="event-content">
                        <div class="event-title">${event.title}</div>
                        <div class="event-date">${event.date}</div>
                        <div class="event-price">$${event.price}</div>
                        <button class="btn btn-primary" onclick="payForEvent('${event.id}', ${event.price})">
                            Comprar Entrada
                        </button>
                    </div>
                `;
                return card;
            }
        }

        5️⃣ main.js - Archivo principal
        --------------------------------
        // Variables globales
        let ilpApi, paymentHandler, uiController;
        
        // IMPLEMENTAR: Inicialización de la app
        document.addEventListener('DOMContentLoaded', async function() {
            // Inicializar componentes
            ilpApi = new InterledgerAPI();
            paymentHandler = new PaymentHandler(ilpApi);
            uiController = new UIController();
            
            // Mostrar pantalla de carga
            setTimeout(() => {
                uiController.showLoginScreen();
            }, 2000);
            
            // Verificar si hay sesión guardada
            const savedSession = localStorage.getItem('paylink_session');
            if (savedSession) {
                const session = JSON.parse(savedSession);
                await autoLogin(session);
            }
        });
        
        // IMPLEMENTAR: Funciones principales que faltan
        async function loginWithWallet() {
            // Mostrar formulario de conexión manual
            document.getElementById('manualConnectForm').style.display = 'block';
        }
        
        async function demoLogin() {
            // Usar billetera de prueba
            const demoConfig = CONFIG.TEST_WALLETS.demo;
            const connected = await ilpApi.connectWallet(demoConfig);
            
            if (connected) {
                const balance = await ilpApi.getBalance();
                uiController.showMainApp({
                    name: 'Usuario Demo',
                    ilpAddress: demoConfig.address,
                    balance: balance
                });
                
                // Cargar eventos
                await uiController.loadEvents();
            }
        }
        
        async function payForEvent(eventId, amount) {
            try {
                const result = await paymentHandler.processEventPayment(eventId, amount);
                
                if (result.success) {
                    // Mostrar modal de éxito con enlace
                    document.getElementById('successMessage').textContent = 
                        '¡Entrada comprada exitosamente!';
                    document.getElementById('eventLink').value = result.accessLink;
                    document.getElementById('eventAccessInfo').style.display = 'block';
                    document.getElementById('successModal').style.display = 'flex';
                }
            } catch (error) {
                alert('Error al procesar pago: ' + error.message);
            }
        }

        ========================================================================
        🚀 PASOS PARA IMPLEMENTACIÓN COMPLETA:
        ========================================================================
        
        1. CONFIGURAR BILLETERA DE PRUEBA:
           - Registrarse en https://rafiki.money o similar
           - Obtener tokens de acceso
           - Configurar webhooks para notificaciones
        
        2. IMPLEMENTAR INTERLEDGER:
           - npm install @interledger/stream-receiver
           - npm install @interledger/pay
           - Configurar STREAM payments
        
        3. BACKEND PARA EVENTOS:
           - API para gestionar eventos
           - Base de datos para enlaces de acceso
           - Sistema de emails para enviar enlaces
        
        4. FUNCIONES MÓVILES:
           - Web NFC API para pagos por proximidad
           - Web Bluetooth API para conexiones P2P
           - Payment Request API para tarjetas
        
        5. SEGURIDAD:
           - Validación de transacciones
           - Encriptación de enlaces de acceso
           - Timeouts para enlaces temporales
        
        6. TESTING:
           - Probar con múltiples billeteras
           - Verificar compatibilidad móvil
           - Testear flujos de pago completos
        
        ========================================================================
        */
    </script>

    <style>
        /* Estilos base aquí - se moverán a styles.css */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            overflow-x: hidden;
        }

        /* Pantalla de carga */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .loading-content {
            text-align: center;
            color: white;
        }

        .loading-logo {
            font-size: 4em;
            margin-bottom: 20px;
            animation: bounce 2s infinite;
        }

        .loading-text {
            font-size: 1.2em;
            margin-bottom: 30px;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top: 3px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-30px); }
            60% { transform: translateY(-15px); }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Pantallas principales */
        .screen {
            min-height: 100vh;
            width: 100%;
        }

        /* Login Screen */
        .login-screen {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .login-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 40px;
            max-width: 480px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
        }

        .login-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .logo {
            font-size: 3em;
            font-weight: bold;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 15px;
        }

        .login-header h2 {
            margin-bottom: 10px;
            color: #333;
        }

        .login-header p {
            color: #666;
            font-size: 1.1em;
        }

        .login-options {
            margin-bottom: 30px;
        }

        .login-option {
            display: flex;
            align-items: center;
            padding: 20px;
            margin-bottom: 15px;
            background: white;
            border: 2px solid #f0f0f0;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .login-option:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.15);
        }

        .option-icon {
            font-size: 2em;
            margin-right: 20px;
            width: 60px;
            text-align: center;
        }

        .option-content h3 {
            margin-bottom: 5px;
            color: #333;
        }

        .option-content p {
            color: #666;
            font-size: 0.9em;
        }

        .option-arrow {
            margin-left: auto;
            font-size: 1.5em;
            color: #667eea;
        }

        .manual-connect {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 16px;
            margin-top: 20px;
        }

        .manual-connect h3 {
            margin-bottom: 20px;
            color: #333;
        }

        /* Main App */
        .main-app {
            display: flex;
            flex-direction: column;
            background: #f5f7fa;
        }

        .app-header {
            background: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar {
            width: 45px;
            height: 45px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2em;
        }

        .user-name {
            font-weight: 600;
            color: #333;
        }

        .connection-status {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9em;
            color: #666;
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
        }

        .status-connected { background: #28a745; }
        .status-pending { background: #ffc107; }
        .status-error { background: #dc3545; }

        .header-actions {
            display: flex;
            gap: 10px;
        }

        .icon-btn {
            width: 40px;
            height: 40px;
            border: none;
            background: #f8f9fa;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1.2em;
            transition: all 0.3s ease;
        }

        .icon-btn:hover {
            background: #e9ecef;
            transform: translateY(-1px);
        }

        /* Navigation */
        .main-nav {
            background: white;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: space-around;
            padding: 10px 20px;
            position: sticky;
            bottom: 0;
            z-index: 100;
        }

        .nav-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            padding: 12px 16px;
            border: none;
            background: none;
            cursor: pointer;
            border-radius: 12px;
            transition: all 0.3s ease;
            min-width: 70px;
        }

        .nav-btn.active {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }

        .nav-btn:not(.active):hover {
            background: #f8f9fa;
        }

        .nav-icon {
            font-size: 1.4em;
        }

        .nav-text {
            font-size: 0.8em;
            font-weight: 500;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }

        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Wallet Section */
        .wallet-overview {
            display: grid;
            gap: 20px;
        }

        .balance-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }

        .balance-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .balance-header h3 {
            margin: 0;
            opacity: 0.9;
        }

        .refresh-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1em;
        }

        .balance-amount {
            font-size: 3em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .balance-subtitle {
            opacity: 0.8;
            margin-bottom: 25px;
        }

        .balance-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .wallet-details {
            background: white;
            padding: 25px;
            border-radius: 16px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
        }

        .detail-item {
            margin-bottom: 20px;
        }

        .detail-item:last-child {
            margin-bottom: 0;
        }

        .detail-item label {
            display: block;
            font-weight: 600;
            color: #555;
            margin-bottom: 8px;
        }

        .address-container {
            display: flex;
            gap: 10px;
        }

        .copy-btn {
            background: #f8f9fa;
            border: 1px solid #ddd;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1em;
        }

        .network-info {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 16px;
            background: rgba(40, 167, 69, 0.1);
            border-radius: 8px;
            color: #28a745;
        }

        /* Payments Section */
        .payments-container {
            display: grid;
            gap: 25px;
        }

        .quick-actions h3 {
            margin-bottom: 20px;
            color: #333;
        }

        .quick-action-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .quick-action {
            background: white;
            border: 2px solid #f0f0f0;
            padding: 25px 15px;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .quick-action:hover {
            border-color: #667eea;
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.15);
        }

        .action-icon {
            font-size: 2.5em;
            margin-bottom: 15px;
        }

        .action-text {
            font-weight: 600;
            color: #333;
        }

        .payment-form-container {
            background: white;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
        }

        .payment-form-container h3 {
            margin-bottom: 25px;
            color: #333;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 20px;
            position: relative;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            color: #555;
            margin-bottom: 8px;
        }

        .form-control {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e1e5e9;
            border-radius: 12px;
            font-size: 16px;
            transition: border-color 0.3s ease;
            background: white;
        }

        .form-control:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .amount-input {
            position: relative;
        }

        .currency-symbol {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 18px;
            font-weight: bold;
            color: #667eea;
            z-index: 1;
        }

        .amount-input .form-control {
            padding-left: 35px;
        }

        .input-helper {
            position: absolute;
            right: 5px;
            top: 50%;
            transform: translateY(-50%);
            background: #f8f9fa;
            border: none;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1em;
        }

        /* Buttons */
        .btn {
            padding: 14px 24px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #f8f9fa;
            color: #333;
            border: 2px solid #e1e5e9;
        }

        .btn-secondary:hover {
            background: #e9ecef;
            transform: translateY(-1px);
        }

        .btn-large {
            padding: 18px 32px;
            font-size: 18px;
            width: 100%;
        }

        /* Events Section */
        .events-container {
            background: white;
            padding: 25px;
            border-radius: 16px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
        }

        .events-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .events-header h3 {
            color: #333;
            margin: 0;
        }

        .events-filters, .history-filters {
            display: flex;
            gap: 10px;
        }

        .filter-btn {
            padding: 8px 16px;
            border: 2px solid #e1e5e9;
            background: white;
            color: #666;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .filter-btn.active {
            background: #667eea;
            border-color: #667eea;
            color: white;
        }

        .filter-btn:hover:not(.active) {
            border-color: #ccc;
        }

        .events-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .event-card {
            background: white;
            border: 2px solid #f0f0f0;
            border-radius: 16px;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .event-card:hover {
            border-color: #667eea;
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.1);
        }

        .event-image {
            height: 120px;
            background: linear-gradient(45deg, #ff6b6b, #feca57);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3em;
        }

        .event-content {
            padding: 20px;
        }

        .event-title {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 8px;
            color: #333;
        }

        .event-date {
            color: #666;
            margin-bottom: 15px;
            font-size: 0.9em;
        }

        .event-price {
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 15px;
        }

        /* History Section */
        .history-container {
            background: white;
            padding: 25px;
            border-radius: 16px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .transactions-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .transaction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
            transition: all 0.3s ease;
        }

        .transaction-item:hover {
            background: #f1f3f4;
            transform: translateX(5px);
        }

        .transaction-info h4 {
            margin-bottom: 5px;
            color: #333;
        }

        .transaction-date {
            color: #666;
            font-size: 0.9em;
        }

        .transaction-amount {
            font-size: 1.2em;
            font-weight: bold;
        }

        .amount-positive { color: #28a745; }
        .amount-negative { color: #dc3545; }

        /* Modals */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                transform: scale(0.9) translateY(-20px);
                opacity: 0;
            }
            to {
                transform: scale(1) translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 25px 25px 0;
        }

        .modal-header h3 {
            margin: 0;
            color: #333;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999;
            padding: 5px;
        }

        .close-btn:hover {
            color: #333;
        }

        .modal-body {
            padding: 25px;
        }

        .modal-actions {
            padding: 0 25px 25px;
            display: flex;
            gap: 15px;
            justify-content: flex-end;
        }

        .payment-summary {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #eee;
        }

        .summary-item:last-child {
            border-bottom: none;
            font-weight: bold;
        }

        .amount-highlight {
            color: #667eea;
            font-weight: bold;
            font-size: 1.1em;
        }

        /* Success Modal */
        .success-modal .modal-content {
            text-align: center;
        }

        .success-content {
            padding: 40px 25px;
        }

        .success-icon {
            font-size: 4em;
            margin-bottom: 20px;
            animation: bounce 1s ease infinite;
        }

        .success-content h3 {
            margin-bottom: 15px;
            color: #333;
        }

        .success-content p {
            color: #666;
            margin-bottom: 25px;
        }

        .access-info {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            text-align: left;
        }

        .access-info h4 {
            margin-bottom: 10px;
            color: #333;
        }

        .access-link {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .access-link .form-control {
            flex: 1;
        }

        /* QR Modal */
        .qr-reader {
            background: #f8f9fa;
            height: 300px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        .camera-placeholder {
            text-align: center;
            color: #666;
        }

        .camera-placeholder p {
            margin-bottom: 10px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .main-content {
                padding: 15px;
            }
            
            .header-content {
                padding: 15px;
            }
            
            .login-container {
                margin: 20px;
                padding: 30px 20px;
            }
            
            .balance-card {
                padding: 25px 20px;
            }
            
            .balance-amount {
                font-size: 2.5em;
            }
            
            .events-grid {
                grid-template-columns: 1fr;
            }
            
            .quick-action-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .events-header, .history-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .modal-content {
                width: 95%;
                margin: 20px auto;
            }
        }

        @media (max-width: 480px) {
            .balance-actions {
                flex-direction: column;
                gap: 10px;
            }
            
            .balance-actions .btn {
                width: 100%;
            }
            
            .nav-text {
                font-size: 0.7em;
            }
            
            .modal-actions {
                flex-direction: column;
            }
            
            .modal-actions .btn {
                width: 100%;
            }
        }